/*! FuzzyJS - v0.1.0 - 2014-03-25
* https://github.com/alocay/FuzzyJS
* Copyright (c) 2014 Armando Locay; Licensed MIT */
!function(a){"use strict";function b(){return x?new x:a.document.createElement("canvas")}function c(b){return x&&b instanceof y||a.HTMLImageElement&&b instanceof a.HTMLImageElement}function d(b){return x&&b instanceof x||a.HTMLCanvasElement&&b instanceof a.HTMLCanvasElement}function e(a){var b=s.width=a.width,c=s.height=a.height;v=new r(b,c),t.drawImage(a,0,0,v.width,v.height)}function f(a){var b,c,d=s.width=a.width,e=s.height=a.height;v=new r(d,e),w=a,b=w.getContext("2d"),c=b.getImageData(0,0,v.width,v.height),t.putImageData(c,0,0)}function g(a,b){var c=new y,d=h(a,b);return c.width=d.width,c.height=d.height,c.src=i(d),c}function h(a,b){var c=a,d=b,e=a&&"number"==typeof a&&a>0,f=b&&"number"==typeof b&&b>0;return e&&!f?d=a!==s.width?a/s.width*s.height|0:s.height:f&&!e?c=b!==s.height?b/s.height*s.width|0:s.width:e||e||(c=s.width,d=s.height),new r(c,d)}function i(a){var c=s;return(a.width!==v.width||a.height!==v.height)&&(c=b(),c.width=a.width,c.height=a.height,c.getContext("2d").drawImage(s,0,0,a.width,a.height)),c.toDataURL()}function j(){var a=b();return a.width=s.width,a.height=s.height,a.getContext("2d").drawImage(s,0,0,s.width,s.height),a}function k(a){for(var b=0;b<u.data.length;b+=4){var c,d,e;switch(a){case A.colorFilters.RED:c=u.data[b],d=255-u.data[b+1],e=255-u.data[b+2];break;case A.colorFilters.GREEN:c=255-u.data[b],d=u.data[b+1],e=255-u.data[b+2];break;case A.colorFilters.BLUE:c=255-u.data[b],d=255-u.data[b+1],e=u.data[b+2];break;default:c=255-u.data[b],d=255-u.data[b+1],e=255-u.data[b+2]}u.data[b]=Math.min(255,Math.max(0,c)),u.data[b+1]=Math.min(255,Math.max(0,d)),u.data[b+2]=Math.min(255,Math.max(0,e))}}function l(a,b,c,d,e,f){for(var g=0,h=0,i=0,j=0,k=a;a+e>k&&c>k;k++)for(var l=b;b+f>l&&d>l;l++){var n=m(k,l);g+=n.r,i+=n.b,h+=n.g,j++}return g=g/j|0,h=h/j|0,i=i/j|0,new q(g,i,h)}function m(a,b){var c=4*(a+b*u.width);return new q(u.data[c+0],u.data[c+1],u.data[c+2],u.data[c+3])}function n(a,b,c,d){var e;d=d||u.data,e=4*(a+b*u.width),d[e+0]=c.r,d[e+1]=c.g,d[e+2]=c.b,d[e+3]=c.a}function o(a,b,c,d,e){for(var f,g,h,i,j=0,k=0,l=0,n=0;n<c.length;n++,a++){i=b;for(var o=0;o<c.length;o++,i++)if(u.data[a]&&u.data[i]){var p=m(a,i);j+=p.r*c[n][o],k+=p.g*c[n][o],l+=p.b*c[n][o]}}return f=Math.min(255,Math.max(0,j/d+e)),g=Math.min(255,Math.max(0,k/d+e)),h=Math.min(255,Math.max(0,l/d+e)),new q(f,g,h)}function p(a,b){b=0>b?0:b,a=0>a?0:a;for(var c=0;c<v.width;c++)for(var d=0;d<v.height;d++)for(var e=l(c,d,v.width,v.height,a,b),f=c;c+a>f&&f<v.width;f++)for(var g=d;d+b>g&&g<v.height;g++)e.a=m(f,g).a,n(f,g,e)}function q(a,b,c,d){this.r=a&&"number"==typeof a?Math.min(255,Math.max(0,a)):0,this.g=b&&"number"==typeof b?Math.min(255,Math.max(0,b)):0,this.b=c&&"number"==typeof c?Math.min(255,Math.max(0,c)):0,this.a=d&&"number"==typeof d?Math.min(255,Math.max(0,d)):255}function r(a,b){this.width=!a||"number"!=typeof a||0>a?0:a,this.height=!b||"number"!=typeof b||0>b?0:b}var s,t,u,v,w,x=a.require&&"function"==typeof a.require?a.require("canvas"):null,y=x?x.Image:a.Image,z={emboss:[[-2,-1,0],[-1,1,1],[0,1,2]],edge:[[0,1,0],[1,-4,1],[0,1,0]],luminosity:[[0,0,0],[0,1,0],[0,0,0]],gaussianblur:[[1,2,1],[2,4,2],[1,2,1]],lighten:[[0,0,0],[0,1.5,0],[0,0,0]],darken:[[0,0,0],[0,.66,0],[0,0,0]],sharpen:[[0,-.33,0],[-.33,2.33,-.33],[0,-.33,0]]},A=function(a){if(s=b(),t=s.getContext("2d"),c(a)){if(!x&&!a.complete)throw"image must first be loaded (src: "+a.src+")";e(a)}else{if(!d(a))return null;f(a)}return u=t.getImageData(0,0,v.width,v.height),A};A.colorFilters={RED:"red",GREEN:"green",BLUE:"blue",NONE:"none"},A.directions={VERTICAL:"vertical",HORIZONTAL:"horizontal"},A.colorFilter=function(a){for(var b=0;b<u.data.length;b+=4){switch(a){case A.colorFilters.RED:u.data[b+1]=0,u.data[b+2]=0;break;case A.colorFilters.GREEN:u.data[b]=0,u.data[b+2]=0;break;case A.colorFilters.BLUE:u.data[b]=0,u.data[b+1]=0}}return this},A.invert=function(a){return k(a?a:A.colorFilters.NONE),this},A.greyscale=function(){for(var a=0;a<u.data.length;a+=4){var b=.299*u.data[a]+.587*u.data[a+1]+.114*u.data[a+2];u.data[a]=u.data[a+1]=u.data[a+2]=b}return this},A.pixelate=function(a){a=0>=a?1:a,a=a>=v.width?v.width-1:a;for(var b=0;b<v.width;b+=a)for(var c=0;c<v.height;c+=a){for(var d=a/2|0,e=a/2|0;b+d>=v.width;)d--;for(;c+e>=v.height;)e--;for(var f=m(b+d,c+e),g=b;b+a>g&&g<v.width;g++)for(var h=c;c+a>h&&h<v.height;h++)n(g,h,f)}return this},A.boxBlur=function(a){return a=!a||"number"!=typeof a||0>a?0:a,p(new r(a,a)),this},A.motionBlur=function(a,b){switch(a=!a||"number"!=typeof a||0>a?0:a,b=b||A.directions.HORIZONTAL){case A.directions.HORIZONTAL:p(new r(a,1));break;case A.directions.VERTICAL:p(new r(1,a))}return this},A.gaussianBlur=function(){return A.convolution(z.gaussianblur,16),this},A.emboss=function(){return A.convolution(z.emboss,1),this},A.sharpen=function(){return A.convolution(z.sharpen,1),this},A.luminosity=function(a){var b=z.luminosity.slice(0);return a=a&&"number"==typeof a?a:1,b[1][1]=a,A.convolution(b,1),this},A.edgetrace=function(){return A.convolution(z.edge,1),this},A.convolution=function(a,b,c){var d=[];if(!(a&&a instanceof Array&&3===a.length))throw"Convolution matrix should be 3x3 matrix";b=!b||1>b||"number"!=typeof b?1:b,c=c&&"number"==typeof c?c:0;for(var e=0;e<v.width;e++)for(var f=0;f<v.height;f++){var g=o(e-1,f-1,a,b,c);n(e,f,g,d)}for(var h=0;h<d.length;h++)u.data[h]=d[h];return this},A.draw=function(a,b){if(t.putImageData(u,0,0),b=b||{},c(a)){var d=b.width||a.width,e=b.height||a.height,f=h(d,e);a.src=i(f)}if(b.overwrite===!0&&w&&w.getContext("2d").putImageData(u,0,0),b.callback&&"function"==typeof b.callback){var k=g(b.width,b.height);b.callback(k)}return j()},A.scale=function(a,b){return t.putImageData(u,0,0),g(a,b)},a.fuzzy=A}("object"==typeof exports&&exports||this);