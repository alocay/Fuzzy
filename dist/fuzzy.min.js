/*! FuzzyJS - v0.1.0 - 2014-03-21
* https://github.com/alocay/FuzzyJS
* Copyright (c) 2014 Armando Locay; Licensed MIT */
!function(a){"use strict";function b(a){var b=p.width=a.width,c=p.height=a.height;s=new o(b,c),q.drawImage(a,0,0,s.width,s.height)}function c(a){var b,c,d=p.width=a.width,e=p.height=a.height;s=new o(d,e),t=a,b=t.getContext("2d"),c=b.getImageData(0,0,s.width,s.height),q.putImageData(c,0,0)}function d(b,c){var d=new a.Image,g=e(b,c);return d.width=g.width,d.height=g.height,d.src=f(g),d}function e(a,b){var c=a,d=b,e=a&&"number"==typeof a,f=b&&"number"==typeof b;return e&&!f?d=a!==p.width?a/p.width*p.height|0:p.height:f&&!e?c=b!==p.height?b/p.height*p.width|0:p.width:e||e||(c=p.width,d=p.height),new o(c,d)}function f(b){var c=p;return(b.width!==s.width||b.height!==s.height)&&(c=a.document.createElement("canvas"),c.width=b.width,c.height=b.height,c.getContext("2d").drawImage(p,0,0,b.width,b.height)),c.toDataURL()}function g(){var b=a.document.createElement("canvas");return b.width=p.width,b.height=p.height,b.getContext("2d").drawImage(p,0,0,p.width,p.height),b}function h(a){for(var b=0;b<r.data.length;b+=4){var c,d,e;switch(a){case v.colorFilters.RED:c=r.data[b],d=255-r.data[b+1],e=255-r.data[b+2];break;case v.colorFilters.GREEN:c=255-r.data[b],d=r.data[b+1],e=255-r.data[b+2];break;case v.colorFilters.BLUE:c=255-r.data[b],d=255-r.data[b+1],e=r.data[b+2];break;default:c=255-r.data[b],d=255-r.data[b+1],e=255-r.data[b+2]}r.data[b]=Math.min(255,Math.max(0,c)),r.data[b+1]=Math.min(255,Math.max(0,d)),r.data[b+2]=Math.min(255,Math.max(0,e))}}function i(a,b,c,d,e,f){for(var g=0,h=0,i=0,k=0,l=a;a+e>l&&c>l;l++)for(var m=b;b+f>m&&d>m;m++){var o=j(l,m);g+=o.r,i+=o.b,h+=o.g,k++}return g=g/k|0,h=h/k|0,i=i/k|0,new n(g,i,h)}function j(a,b){var c=4*(a+b*r.width);return new n(r.data[c+0],r.data[c+1],r.data[c+2],r.data[c+3])}function k(a,b,c,d){var e;d=d||r.data,e=4*(a+b*r.width),d[e+0]=c.r,d[e+1]=c.g,d[e+2]=c.b,d[e+3]=c.a}function l(a,b,c,d,e){for(var f,g,h,i,k=0,l=0,m=0,o=0;o<c.length;o++,a++){i=b;for(var p=0;p<c.length;p++,i++)if(r.data[a]&&r.data[i]){var q=j(a,i);k+=q.r*c[o][p],l+=q.g*c[o][p],m+=q.b*c[o][p]}}return f=Math.min(255,Math.max(0,k/d+e)),g=Math.min(255,Math.max(0,l/d+e)),h=Math.min(255,Math.max(0,m/d+e)),new n(f,g,h)}function m(a,b){b=0>b?0:b,a=0>a?0:a;for(var c=0;c<s.width;c++)for(var d=0;d<s.height;d++)for(var e=i(c,d,s.width,s.height,a,b),f=c;c+a>f&&f<s.width;f++)for(var g=d;d+b>g&&g<s.height;g++)e.a=j(f,g).a,k(f,g,e)}function n(a,b,c,d){this.r=a&&"number"==typeof a?Math.min(255,Math.max(0,a)):0,this.g=b&&"number"==typeof b?Math.min(255,Math.max(0,b)):0,this.b=c&&"number"==typeof c?Math.min(255,Math.max(0,c)):0,this.a=d&&"number"==typeof d?Math.min(255,Math.max(0,d)):255}function o(a,b){this.width=!a||"number"!=typeof a||0>a?0:a,this.height=!b||"number"!=typeof b||0>b?0:b}var p,q,r,s,t,u={emboss:[[-2,-1,0],[-1,1,1],[0,1,2]],edge:[[0,1,0],[1,-4,1],[0,1,0]],luminosity:[[0,0,0],[0,1,0],[0,0,0]],gaussianblur:[[1,2,1],[2,4,2],[1,2,1]],lighten:[[0,0,0],[0,1.5,0],[0,0,0]],darken:[[0,0,0],[0,.66,0],[0,0,0]],sharpen:[[0,-.33,0],[-.33,2.33,-.33],[0,-.33,0]]},v=function(d){if(p=a.document.createElement("canvas"),q=p.getContext("2d"),d instanceof a.HTMLImageElement){if(!d.complete)throw"image must first be loaded (src: "+d.src+")";b(d)}else{if(!(d instanceof a.HTMLCanvasElement))return null;c(d)}return r=q.getImageData(0,0,s.width,s.height),v};v.colorFilters={RED:"red",GREEN:"green",BLUE:"blue",NONE:"none"},v.directions={VERTICAL:"vertical",HORIZONTAL:"horizontal"},v.colorFilter=function(a){for(var b=0;b<r.data.length;b+=4){switch(a){case v.colorFilters.RED:r.data[b+1]=0,r.data[b+2]=0;break;case v.colorFilters.GREEN:r.data[b]=0,r.data[b+2]=0;break;case v.colorFilters.BLUE:r.data[b]=0,r.data[b+1]=0}}return this},v.invert=function(a){return h(a?a:v.colorFilters.NONE),this},v.greyscale=function(){for(var a=0;a<r.data.length;a+=4){var b=.299*r.data[a]+.587*r.data[a+1]+.114*r.data[a+2];r.data[a]=r.data[a+1]=r.data[a+2]=b}return this},v.pixelate=function(a){a=0>=a?1:a,a=a>=s.width?s.width-1:a;for(var b=0;b<s.width;b+=a)for(var c=0;c<s.height;c+=a){for(var d=a/2|0,e=a/2|0;b+d>=s.width;)d--;for(;c+e>=s.height;)e--;for(var f=j(b+d,c+e),g=b;b+a>g&&g<s.width;g++)for(var h=c;c+a>h&&h<s.height;h++)k(g,h,f)}return this},v.boxBlur=function(a){return a=!a||"number"!=typeof a||0>a?0:a,m(new o(a,a)),this},v.motionBlur=function(a,b){switch(a=!a||"number"!=typeof a||0>a?0:a,b=b||v.directions.HORIZONTAL){case v.directions.HORIZONTAL:m(new o(a,1));break;case v.directions.VERTICAL:m(new o(1,a))}return this},v.gaussianBlur=function(){return v.convolution(u.gaussianblur,16),this},v.emboss=function(){return v.convolution(u.emboss,1),this},v.sharpen=function(){return v.convolution(u.sharpen,1),this},v.luminosity=function(a){var b=u.luminosity.slice(0);return a=a&&"number"==typeof a?a:1,b[1][1]=a,v.convolution(b,1),this},v.edgetrace=function(){return v.convolution(u.edge,1),this},v.convolution=function(a,b,c){var d=[];if(!(a&&a instanceof Array&&3===a.length))throw"Convolution matrix should be 3x3 matrix";b=!b||1>b||"number"!=typeof b?1:b,c=c&&"number"==typeof c?c:0;for(var e=0;e<s.width;e++)for(var f=0;f<s.height;f++){var g=l(e-1,f-1,a,b,c);k(e,f,g,d)}for(var h=0;h<d.length;h++)r.data[h]=d[h];return this},v.draw=function(b,c){if(q.putImageData(r,0,0),c=c||{},b instanceof a.HTMLImageElement){var e=c.width||b.width,h=c.height||b.height,i=b.attributes.width,j=b.attributes.height;e=0>=e&&i?i.value:p.width,h=0>=h&&j?j.value:p.height,b.src=f(new o(e,h))}if(c.overwrite===!0&&t&&t.getContext("2d").putImageData(r,0,0),c.callback&&"function"==typeof c.callback){var k=d(c.width,c.height);c.callback(k)}return g()},v.scale=function(a,b){return q.putImageData(r,0,0),d(a,b)},a.fuzzy=v}(this);