/*! FuzzyJS - v0.1.0 - 2015-03-25
* https://github.com/alocay/FuzzyJS
* Copyright (c) 2015 Armando Locay; Licensed MIT */
!function(a){"use strict";function b(a){var b=m.width=a.width,c=m.height=a.height;o=new l(b,c),m.getContext("2d").drawImage(a,0,0,a.width,a.height)}function c(a){var b,c,d=m.width=a.width,e=m.height=a.height;o=new l(d,e),p=a,b=p.getContext("2d"),c=b.getImageData(0,0,o.width,o.height),m.getContext("2d").putImageData(c,0,0)}function d(a){for(var b=0;b<n.data.length;b+=4){var c,d,e;switch(a){case"red":c=n.data[b],d=255-n.data[b+1],e=255-n.data[b+2];break;case"green":c=255-n.data[b],d=n.data[b+1],e=255-n.data[b+2];break;case"blue":c=255-n.data[b],d=255-n.data[b+1],e=n.data[b+2];break;default:c=255-n.data[b],d=255-n.data[b+1],e=255-n.data[b+2]}n.data[b]=Math.min(255,Math.max(0,c)),n.data[b+1]=Math.min(255,Math.max(0,d)),n.data[b+2]=Math.min(255,Math.max(0,e))}}function e(a,b,c,d,e,g){for(var h=0,i=0,j=0,l=0,m=a;a+e>m&&c>m;m++)for(var n=b;b+g>n&&d>n;n++){var o=f(m,n);h+=o.r,j+=o.b,i+=o.g,l++}return h=h/l|0,i=i/l|0,j=j/l|0,new k(h,j,i)}function f(a,b){var c=4*(a+b*n.width);return new k(n.data[c+0],n.data[c+1],n.data[c+2],n.data[c+3])}function g(a,b,c,d){var e;d=d||n.data,e=4*(a+b*n.width),d[e+0]=c.r,d[e+1]=c.g,d[e+2]=c.b,d[e+3]=c.a}function h(a,b,c,d,e){for(var g,h,i,j,l=0,m=0,o=0,p=0;p<c.length;p++,a++){j=b;for(var q=0;q<c.length;q++,j++)if(n.data[a]&&n.data[j]){var r=f(a,j);l+=r.r*c[p][q],m+=r.g*c[p][q],o+=r.b*c[p][q]}}return g=Math.min(255,Math.max(0,l/d+e)),h=Math.min(255,Math.max(0,m/d+e)),i=Math.min(255,Math.max(0,o/d+e)),new k(g,h,i)}function i(a,b){b=0>b?0:b,a=0>a?0:a;for(var c=0;c<o.width;c++)for(var d=0;d<o.height;d++)for(var h=e(c,d,o.width,o.height,a,b),i=c;c+a>i&&i<o.width;i++)for(var j=d;d+b>j&&j<o.height;j++)h.a=f(i,j).a,g(i,j,h)}function j(a){if("string"!=typeof a)throw"Fuzzy: Color filter expected to be a string";if("red"!==a&&"green"!==a&&"blue"!==a)throw"Fuzzy: Unknown color filter"}function k(a,b,c,d){this.r=a&&"number"==typeof a?Math.min(255,Math.max(0,a)):0,this.g=b&&"number"==typeof b?Math.min(255,Math.max(0,b)):0,this.b=c&&"number"==typeof c?Math.min(255,Math.max(0,c)):0,this.a=d&&"number"==typeof d?Math.min(255,Math.max(0,d)):255}function l(a,b){this.width=!a||"number"!=typeof a||0>a?0:a,this.height=!b||"number"!=typeof b||0>b?0:b}var m,n,o,p,q={emboss:[[-2,-1,0],[-1,1,1],[0,1,2]],edge:[[0,1,0],[1,-4,1],[0,1,0]],luminosity:[[0,0,0],[0,1,0],[0,0,0]],gaussianblur:[[1,2,1],[2,4,2],[1,2,1]],lighten:[[0,0,0],[0,1.5,0],[0,0,0]],darken:[[0,0,0],[0,.66,0],[0,0,0]],sharpen:[[0,-.33,0],[-.33,2.33,-.33],[0,-.33,0]]},r=function(d){if(m=a.document.createElement("canvas"),d instanceof a.HTMLImageElement){if(!d.complete)throw"image must first be loaded (src: "+d.src+")";b(d)}else{if(!(d instanceof a.HTMLCanvasElement))return null;c(d)}return n=m.getContext("2d").getImageData(0,0,d.width,d.height),r};r.colorFilter=function(a){a=a.toLowerCase(),j(a);for(var b=0;b<n.data.length;b+=4)switch(a){case"red":n.data[b+1]=0,n.data[b+2]=0;break;case"green":n.data[b]=0,n.data[b+2]=0;break;case"blue":n.data[b]=0,n.data[b+1]=0}return this},r.invert=function(a){return a?(a=a.toLowerCase(),j(a),d(a)):d(),this},r.greyscale=function(){for(var a=0;a<n.data.length;a+=4){var b=.299*n.data[a]+.587*n.data[a+1]+.114*n.data[a+2];n.data[a]=n.data[a+1]=n.data[a+2]=b}return this},r.pixelate=function(a){a=0>=a?1:a,a=a>=m.width?m.width-1:a;for(var b=0;b<m.width;b+=a)for(var c=0;c<m.height;c+=a){for(var d=a/2|0,e=a/2|0;b+d>=m.width;)d--;for(;c+e>=m.height;)e--;for(var h=f(b+d,c+e),i=b;b+a>i&&i<m.width;i++)for(var j=c;c+a>j&&j<m.height;j++)g(i,j,h)}return this},r.boxBlur=function(a){return a=!a||"number"!=typeof a||0>a?0:a,i(a,a),this},r.horizontalBlur=function(a){return a=!a||"number"!=typeof a||0>a?0:a,i(a,1),this},r.verticalBlur=function(a){return a=!a||"number"!=typeof a||0>a?0:a,i(1,a),this},r.gaussianBlur=function(){return r.convolution(q.gaussianblur,16),this},r.emboss=function(){return r.convolution(q.emboss,1),this},r.sharpen=function(){return r.convolution(q.sharpen,1),this},r.luminosity=function(a){var b=q.luminosity.slice(0);return a=a&&"number"==typeof a?a:1,b[1][1]=a,r.convolution(b,1),this},r.edgetrace=function(){return r.convolution(q.edge,1),this},r.convolution=function(a,b,c){var d=[];if(!(a&&a instanceof Array&&3===a.length))throw"Convolution matrix should be 3x3 matrix";b=!b||1>b||"number"!=typeof b?1:b,c=c&&"number"==typeof c?c:0;for(var e=0;e<o.width;e++)for(var f=0;f<o.height;f++){var i=h(e-1,f-1,a,b,c);g(e,f,i,d)}for(var j=0;j<d.length;j++)n.data[j]=d[j];return this},r.draw=function(b){m.getContext("2d").putImageData(n,0,0),p&&p.getContext("2d").putImageData(n,0,0),b instanceof a.HTMLImageElement&&(b.width=m.width,b.height=m.height,b.src=m.toDataURL()),p=null},a.fuzzy=r}(this);